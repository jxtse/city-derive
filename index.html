<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ æ™ºèƒ½æ•£æ­¥è·¯çº¿è§„åˆ’å™¨</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://webapi.amap.com/maps?v=1.4.15&&key=c9e4a3040fef05c4084a21c8a357d37f"></script>
    <style>
        /* é‡æ–°è®¾è®¡çš„ä¸»è¦æ ·å¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            overflow: hidden;
        }

        /* å…¨å±åœ°å›¾å®¹å™¨ */
        #main-map-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.95), rgba(118, 75, 162, 0.95));
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .app-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            font-weight: 300;
        }
        
        /* ç”¨æˆ·ä½ç½®æ ‡è®° */
        .user-location-marker {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            pointer-events: none;
        }

        /* æ¨¡å¼é€‰æ‹©å®¹å™¨ */
        .mode-selection-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            z-index: 1001;
        }

        /* æ¨¡å¼é€‰æ‹©é—®é¢˜æ–‡æœ¬ */
        .question-left {
            position: fixed;
            bottom: 200px;
            left: calc(50% - 80px);
            transform: translateX(-50%);
            color: #333;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            z-index: 1001;
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
        }

        .question-right {
            position: fixed;
            bottom: 200px;
            right: calc(50% - 80px);
            transform: translateX(50%);
            color: #333;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            z-index: 1001;
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
        }

        /* æ¢ç´¢æ¨¡å¼æŒ‰é’® - é‡æ–°è®¾è®¡ */
        .floating-explore-btn {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 50px;
            box-shadow: 0 45px 45px 0 rgba(166, 166, 166, 0.25);
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .floating-explore-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .floating-explore-btn .btn-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-explore-btn .btn-icon svg {
            width: 48px;
            height: 48px;
        }

        .floating-explore-btn .btn-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            letter-spacing: 1px;
        }

        /* å¯¼èˆªæ¨¡å¼æŒ‰é’® - é‡æ–°è®¾è®¡ */
        .floating-planner-btn {
            width: 160px;
            height: 160px;
            background: white;
            border-radius: 50px;
            box-shadow: 0 45px 45px 0 rgba(166, 166, 166, 0.25);
            border: none;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .floating-planner-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .floating-planner-btn .btn-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .floating-planner-btn .btn-icon svg {
            width: 48px;
            height: 48px;
        }

        .floating-planner-btn .btn-text {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            letter-spacing: 1px;
        }

        /* è§„åˆ’é¢æ¿ */
        .planner-panel {
            position: fixed;
            right: -450px;
            top: 60px;
            bottom: 0;
            width: 450px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow-y: auto;
        }

        .planner-panel.open {
            right: 0;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .panel-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .close-panel-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .close-panel-btn:hover {
            opacity: 1;
        }

        .panel-content {
            padding: 30px;
        }
        
        /* è¡¨å•æ ·å¼é‡æ–°è®¾è®¡ */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
        }
        
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: white;
            color: #333;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .plan-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.3);
        }
        
        .plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(40, 167, 69, 0.4);
        }
        
        .plan-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        /* AIç»ˆç«¯é¢æ¿ */
        .ai-terminal {
            background: linear-gradient(135deg, #0c1622 0%, #1a2332 50%, #0f1419 100%);
            border-radius: 12px;
            margin-top: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            font-family: 'Courier New', 'Monaco', monospace;
            position: relative;
            display: none;
        }
        
        .terminal-header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #4a5568;
        }
        
        .terminal-buttons {
            display: flex;
            gap: 6px;
        }
        
        .terminal-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .terminal-btn.close {
            background: #ff5f56;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .terminal-btn.minimize {
            background: #ffbd2e;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .terminal-btn.maximize {
            background: #27ca3f;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .terminal-title {
            color: #a0aec0;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .terminal-status {
            background: #4299e1;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 8px;
            animation: pulse 2s infinite;
        }
        
        .terminal-content {
            padding: 15px;
            min-height: 120px;
            max-height: 300px;
            overflow-y: auto;
            position: relative;
            font-size: 10px;
        }
        
        /* ç»“æœé¢æ¿ */
        .result-panel {
            position: fixed;
            left: -500px;
            top: 60px;
            bottom: 0;
            width: 500px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            transition: left 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow-y: auto;
            display: none;
        }

        .result-panel.open {
            left: 0;
            display: block;
        }

        /* åœ°å›¾æ§åˆ¶æŒ‰é’® */
        .map-controls {
            position: fixed;
            top: 80px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1001;
        }

        .map-control-btn {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-width: 100px;
        }

        .map-control-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        

        /* ç»ˆç«¯ç›¸å…³æ ·å¼ä¿æŒä¸å˜ */
        .terminal-line {
            margin: 6px 0;
            display: flex;
            align-items: flex-start;
            animation: slideInLeft 0.5s ease-out;
            font-size: 10px;
        }
        
        .prompt {
            color: #4299e1;
            font-weight: 700;
            margin-right: 8px;
            min-width: 60px;
            font-size: 9px;
        }
        
        .system-info .loading-text {
            color: #68d391;
            animation: blink 1.5s infinite;
        }
        
        .main-status .typewriter {
            color: #f7fafc;
            font-size: 11px;
            font-weight: 500;
        }
        
        .detail-status .detail-text {
            color: #a0aec0;
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* Consoleæ—¥å¿—æ ·å¼ */
        .console-logs {
            margin: 8px 0;
            border-left: 2px solid #4299e1;
            padding-left: 8px;
        }
        
        .console-log {
            margin: 4px 0;
            display: flex;
            align-items: flex-start;
            animation: fadeInUp 0.3s ease-out;
            font-size: 9px;
        }
        
        .log-timestamp {
            color: #718096;
            font-size: 8px;
            margin-right: 6px;
            min-width: 50px;
        }
        
        .log-level {
            padding: 1px 4px;
            border-radius: 3px;
            font-size: 7px;
            font-weight: 600;
            margin-right: 6px;
            min-width: 35px;
            text-align: center;
        }
        
        .log-level.info {
            background: #3182ce;
            color: white;
        }
        
        .log-level.success {
            background: #38a169;
            color: white;
        }
        
        .log-level.warning {
            background: #d69e2e;
            color: white;
        }
        
        .log-level.error {
            background: #e53e3e;
            color: white;
        }
        
        .log-level.debug {
            background: #805ad5;
            color: white;
        }
        
        .log-content {
            color: #e2e8f0;
            font-size: 9px;
            flex: 1;
        }
        
        /* AIæ­¥éª¤å®¹å™¨ */
        .planning-steps {
            margin-top: 12px;
            border-top: 1px solid #4a5568;
            padding-top: 12px;
        }
        
        .section-header .section-title {
            color: #9f7aea;
            font-weight: 600;
            font-size: 10px;
        }
        
        .steps-container {
            margin-left: 15px;
        }
        
        .step-item {
            margin: 6px 0;
            padding: 6px 10px;
            background: rgba(79, 209, 197, 0.1);
            border-left: 3px solid #4fd1c5;
            border-radius: 0 6px 6px 0;
            animation: slideInRight 0.5s ease-out;
            position: relative;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .step-title {
            color: #4fd1c5;
            font-weight: 600;
            font-size: 10px;
        }
        
        .step-status {
            font-size: 8px;
            padding: 2px 4px;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .step-status.pending {
            background: #fbd38d;
            color: #744210;
        }
        
        .step-status.running {
            background: #63b3ed;
            color: #1a365d;
            animation: pulse 1s infinite;
        }
        
        .step-status.completed {
            background: #68d391;
            color: #1a365d;
        }
        
        .step-status.failed {
            background: #fc8181;
            color: #742a2a;
        }
        
        .step-description {
            color: #cbd5e0;
            font-size: 9px;
            margin-top: 3px;
        }
        
        .step-detail {
            color: #a0aec0;
            font-size: 8px;
            margin-top: 3px;
            padding: 3px 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-container {
            margin: 12px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #2d3748;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            margin-top: 6px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1 0%, #9f7aea 50%, #4fd1c5 100%);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-glow {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(66, 153, 225, 0.6) 50%, transparent 100%);
            animation: progressGlow 2s infinite;
        }
        
        .progress-label {
            color: #a0aec0;
            font-size: 9px;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  */
        .terminal-footer {
            background: #1a202c;
            padding: 4px 12px;
            border-top: 1px solid #4a5568;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 8px;
        }
        
        .footer-info {
            color: #718096;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .footer-status {
            color: #68d391;
            font-weight: 600;
            padding: 2px 6px;
            background: rgba(104, 211, 145, 0.2);
            border-radius: 4px;
        }
        
        /* åŠ¨ç”»æ•ˆæœä¿æŒ */
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        @keyframes progressGlow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Difyæ™ºèƒ½é—®ç­”å¡ç‰‡æ ·å¼ */
        .dify-card {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 450px;
            max-width: calc(100vw - 40px);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1003;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: none;
        }

        .dify-card.show {
            display: block;
            animation: slideInFromTop 0.4s ease-out;
        }

        .dify-card.minimized .dify-content {
            display: none;
        }

        .dify-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 20px;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dify-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dify-controls {
            display: flex;
            gap: 8px;
        }

        .dify-minimize-btn,
        .dify-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dify-minimize-btn:hover,
        .dify-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .dify-content {
            padding: 24px;
        }

        .dify-input-section {
            margin-bottom: 20px;
        }

        .dify-input-group {
            margin-bottom: 16px;
        }

        .dify-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
        }

        .dify-input-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            color: #333;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .dify-input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .dify-submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .dify-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .dify-submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .dify-loading {
            text-align: center;
            padding: 30px 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        .loading-text {
            color: #667eea;
            font-weight: 500;
        }

        .dify-question-section {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .dify-question {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .dify-question::before {
            content: "â“";
            font-size: 1.2rem;
        }

        .dify-choices-section {
            margin-bottom: 20px;
        }

        .choices-container {
            display: grid;
            gap: 12px;
        }

        .choice-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
        }

        .choice-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .choice-option {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .choice-option::before {
            content: "ğŸ”˜";
            font-size: 1rem;
        }

        .choice-action {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.4;
            display: none;
        }

        .choice-item.selected .choice-action {
            display: block;
            animation: fadeInDown 0.3s ease-out;
        }

        .dify-result-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .result-content {
            margin-bottom: 16px;
        }

        .dify-restart-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 0 auto;
        }

        .dify-restart-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .planner-panel {
                width: 100vw;
                right: -100vw;
            }

            .result-panel {
                width: 100vw;
                left: -100vw;
            }

            .mode-selection-container {
                bottom: 60px;
                gap: 30px;
            }

            .floating-explore-btn,
            .floating-planner-btn {
                width: 130px;
                height: 130px;
            }

            .floating-explore-btn .btn-icon,
            .floating-planner-btn .btn-icon {
                width: 36px;
                height: 36px;
                margin-bottom: 8px;
            }

            .floating-explore-btn .btn-icon svg,
            .floating-planner-btn .btn-icon svg {
                width: 36px;
                height: 36px;
            }

            .floating-explore-btn .btn-text,
            .floating-planner-btn .btn-text {
                font-size: 14px;
            }

            .mode-question {
                bottom: 220px;
                font-size: 16px;
            }

            .question-left {
                right: 50px;
            }

            .question-right {
                left: 50px;
            }

            .user-location-marker svg {
                width: 80px;
                height: 95px;
            }

            .app-title {
                font-size: 1.2rem;
            }

            .app-subtitle {
                display: none;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .map-controls {
                right: 10px;
                top: 70px;
            }

            .map-control-btn {
                padding: 8px;
                font-size: 0.8rem;
                min-width: 80px;
            }

            .dify-card {
                width: calc(100vw - 20px);
                top: 70px;
            }

            .dify-content {
                padding: 16px;
            }
        }
        
        /* å¯å±•å¼€å†…å®¹æ ·å¼ */
        .expandable-section {
            margin-top: 8px;
        }
        
        .expandable-section details {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        
        .expandable-section details:hover {
            background: rgba(0, 0, 0, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .expandable-section details[open] {
            background: rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .expandable-section summary {
            padding: 6px 10px;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            border-radius: 3px;
            font-size: 10px;
        }
        
        .expandable-section summary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .expandable-section summary::marker {
            content: "â–¶ ";
        }
        
        .expandable-section details[open] summary::marker {
            content: "â–¼ ";
        }
        
        /* ç‰¹å®šå†…å®¹ç±»å‹çš„æ ·å¼ */
        .technical-detail {
            border: 1px solid rgba(108, 117, 125, 0.3);
            background: rgba(248, 249, 250, 0.1) !important;
            font-family: 'Courier New', monospace !important;
            color: #e2e8f0 !important;
            line-height: 1.4;
            font-size: 8px !important;
        }
        
        .llm-output {
            border: 1px solid rgba(111, 66, 193, 0.3);
            background: rgba(111, 66, 193, 0.1) !important;
            color: #e2e8f0 !important;
            line-height: 1.4;
            white-space: pre-wrap;
            font-size: 8px !important;
        }
        
        .poi-results {
            border: 1px solid rgba(32, 201, 151, 0.3);
            background: rgba(32, 201, 151, 0.1) !important;
            color: #e2e8f0 !important;
            font-size: 8px !important;
        }
        
        .poi-results .poi-item {
            margin: 4px 0;
            padding: 6px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 3px;
            border-left: 3px solid #20c997;
            animation: slideInFromLeft 0.3s ease-out;
            animation-delay: calc(0.1s * var(--poi-index, 0));
        }
        
        .route-details {
            border: 1px solid rgba(40, 167, 69, 0.3);
            background: rgba(40, 167, 69, 0.1) !important;
            color: #e2e8f0 !important;
            font-size: 8px !important;
        }
        
        /* æ‰“å­—æœºæ•ˆæœ */
        .typewriter::after {
            content: '|';
            animation: blink 1s infinite;
            color: #4299e1;
        }
    </style>
</head>
<body>
    <!-- ä¸»åœ°å›¾å®¹å™¨ -->
    <div id="main-map-container">
        <div id="map"></div>
    </div>

    <!-- ç”¨æˆ·ä½ç½®æ ‡è®° -->
    <div class="user-location-marker" id="user-location-marker">
        <svg xmlns="http://www.w3.org/2000/svg" width="106" height="124" viewBox="0 0 106 124" fill="none">
            <g filter="url(#filter0_d_88_768)">
                <path d="M53 20C44.2509 20.0099 35.863 23.4899 29.6764 29.6765C23.4899 35.8631 20.0099 44.2511 20 53.0003C20 81.2381 50 102.565 51.2788 103.457C51.7832 103.81 52.3841 104 53 104C53.6159 104 54.2168 103.81 54.7212 103.457C56 102.565 86 81.2381 86 53.0003C85.9901 44.2511 82.5101 35.8631 76.3236 29.6765C70.137 23.4899 61.7491 20.0099 53 20Z" fill="white"/>
            </g>
            <circle cx="53.5" cy="53.5" r="27.5" fill="#E7E7E7"/>
            <path d="M49.0837 40.3418C49.0837 39.4831 49.3425 38.6436 49.8274 37.9296C50.3124 37.2156 51.0016 36.6591 51.808 36.3305C52.6144 36.0019 53.5017 35.9159 54.3578 36.0834C55.2139 36.251 56.0002 36.6645 56.6174 37.2717C57.2346 37.8789 57.6549 38.6525 57.8252 39.4948C57.9955 40.337 57.9081 41.21 57.5741 42.0034C57.2401 42.7967 56.6744 43.4748 55.9487 43.9519C55.2229 44.429 54.3697 44.6837 53.4968 44.6837C52.3264 44.6837 51.2039 44.2262 50.3763 43.412C49.5486 42.5977 49.0837 41.4933 49.0837 40.3418ZM67.2754 56.5896L60.1434 48.6347C59.7293 48.1727 59.2199 47.8027 58.6493 47.5492C58.0786 47.2958 57.4596 47.1647 56.8335 47.1647H50.1602C49.5341 47.1647 48.9151 47.2958 48.3444 47.5492C47.7738 47.8027 47.2644 48.1727 46.8503 48.6347L39.7183 56.5896C39.2552 57.0557 38.9972 57.6825 39 58.3343C39.0029 58.9862 39.2663 59.6108 39.7335 60.073C40.2007 60.5353 40.834 60.7981 41.4965 60.8046C42.159 60.8112 42.7976 60.5609 43.2741 60.108L47.3499 56.8873L44.245 68.4986C43.9748 69.0952 43.9547 69.7726 44.189 70.3837C44.4233 70.9948 44.8931 71.4904 45.4964 71.7629C46.0998 72.0354 46.788 72.0628 47.4118 71.8393C48.0355 71.6157 48.5446 71.1591 48.8283 70.5687L53.4968 62.6712L58.159 70.5795C58.4428 71.17 58.9518 71.6265 59.5756 71.8501C60.1994 72.0737 60.8876 72.0463 61.491 71.7738C62.0943 71.5012 62.5641 71.0057 62.7984 70.3945C63.0327 69.7834 63.0126 69.106 62.7424 68.5094L59.6438 56.8873L63.7259 60.108C64.2024 60.5609 64.841 60.8112 65.5035 60.8046C66.166 60.7981 66.7993 60.5353 67.2665 60.073C67.7337 59.6108 67.9971 58.9862 68 58.3343C68.0028 57.6825 67.7448 57.0557 67.2817 56.5896H67.2754Z" fill="#303030"/>
            <defs>
                <filter id="filter0_d_88_768" x="0" y="0" width="106" height="124" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                    <feOffset/>
                    <feGaussianBlur stdDeviation="10"/>
                    <feComposite in2="hardAlpha" operator="out"/>
                    <feColorMatrix type="matrix" values="0 0 0 0 0.545098 0 0 0 0 0.792157 0 0 0 0 0.305882 0 0 0 1 0"/>
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_88_768"/>
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_88_768" result="shape"/>
                </filter>
            </defs>
        </svg>
    </div>

    <!-- æ¨¡å¼é€‰æ‹©é—®é¢˜æ–‡æœ¬ -->
    <div class="question-left">æœ‰æ˜ç¡®çš„åœ°æ–¹ï¼Ÿ</div>
    <div class="question-right">å°±éšæ„èµ°èµ°ï¼Ÿ</div>

    <!-- æ¨¡å¼é€‰æ‹©å®¹å™¨ -->
    <div class="mode-selection-container">
        <!-- å¯¼èˆªæ¨¡å¼æŒ‰é’® -->
        <button class="floating-planner-btn" id="floating-planner-btn" title="æœ‰æ˜ç¡®ç›®çš„åœ°ï¼Œæ™ºèƒ½å¯¼èˆª">
            <div class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M21.3741 11.8125C22.3753 11.8125 23.3541 11.5156 24.1867 10.9593C25.0192 10.403 25.668 9.61239 26.0512 8.68734C26.4344 7.76229 26.5346 6.74439 26.3393 5.76236C26.144 4.78033 25.6618 3.87828 24.9538 3.17027C24.2458 2.46227 23.3438 1.98011 22.3617 1.78478C21.3797 1.58944 20.3618 1.68969 19.4367 2.07286C18.5117 2.45603 17.721 3.1049 17.1648 3.93743C16.6085 4.76995 16.3116 5.74873 16.3116 6.75C16.3116 8.09266 16.8449 9.38033 17.7944 10.3297C18.7438 11.2791 20.0314 11.8125 21.3741 11.8125ZM21.3741 5.0625C21.7078 5.0625 22.0341 5.16147 22.3116 5.3469C22.5891 5.53232 22.8054 5.79587 22.9331 6.10422C23.0608 6.41257 23.0943 6.75187 23.0292 7.07922C22.964 7.40656 22.8033 7.70724 22.5673 7.94324C22.3313 8.17925 22.0306 8.33996 21.7033 8.40508C21.3759 8.47019 21.0367 8.43677 20.7283 8.30905C20.42 8.18133 20.1564 7.96503 19.971 7.68753C19.7855 7.41002 19.6866 7.08376 19.6866 6.75C19.6866 6.30245 19.8644 5.87323 20.1808 5.55676C20.4973 5.24029 20.9265 5.0625 21.3741 5.0625ZM28.6866 20.25V32.625C28.6866 33.0726 28.5088 33.5018 28.1923 33.8182C27.8759 34.1347 27.4466 34.3125 26.9991 34.3125C26.5515 34.3125 26.1223 34.1347 25.8058 33.8182C25.4894 33.5018 25.3116 33.0726 25.3116 32.625V21.8306C21.8072 21.3567 20.5388 19.3992 19.4925 17.7863C19.2745 17.4502 19.0636 17.1239 18.8358 16.8188L17.4942 19.9125L22.3585 23.3761C22.5765 23.5327 22.754 23.739 22.8763 23.978C22.9986 24.2169 23.0621 24.4816 23.0616 24.75V32.625C23.0616 33.0726 22.8838 33.5018 22.5673 33.8182C22.2509 34.1347 21.8216 34.3125 21.3741 34.3125C20.9265 34.3125 20.4973 34.1347 20.1808 33.8182C19.8644 33.5018 19.6866 33.0726 19.6866 32.625V25.6177L16.1189 23.0695L11.671 33.2972C11.5866 33.5062 11.4613 33.6963 11.3023 33.8561C11.1433 34.0159 10.9539 34.1422 10.7453 34.2276C10.5366 34.313 10.313 34.3557 10.0876 34.3532C9.86221 34.3508 9.63958 34.3032 9.43288 34.2133C9.22617 34.1234 9.03957 33.9929 8.8841 33.8297C8.72863 33.6665 8.60743 33.4738 8.52767 33.2629C8.44791 33.0521 8.4112 32.8274 8.41971 32.6022C8.42822 32.3769 8.48177 32.1556 8.5772 31.9514L16.666 13.3453C16.7578 13.1337 16.8921 12.9432 17.0605 12.7855C17.2289 12.6279 17.4279 12.5064 17.645 12.4287C17.8622 12.3509 18.0931 12.3185 18.3233 12.3335C18.5535 12.3484 18.7782 12.4104 18.9835 12.5156C19.4295 12.7471 19.8468 13.0303 20.2266 13.3594C21.18 14.1877 21.7861 15.1214 22.3205 15.9455C23.3808 17.5781 24.0178 18.5625 26.9991 18.5625C27.4466 18.5625 27.8759 18.7403 28.1923 19.0568C28.5088 19.3732 28.6866 19.8025 28.6866 20.25ZM9.08345 21.6394L5.52142 20.1094C5.11182 19.9322 4.78909 19.6 4.62385 19.1854C4.4586 18.7708 4.4643 18.3077 4.6397 17.8973L8.0147 10.0223C8.19189 9.61275 8.52411 9.29001 8.93867 9.12477C9.35323 8.95953 9.81637 8.96523 10.2267 9.14063L13.8281 10.6875C14.0464 10.764 14.2467 10.8847 14.4164 11.0418C14.5861 11.199 14.7217 11.3894 14.8148 11.6012C14.9078 11.813 14.9563 12.0417 14.9573 12.273C14.9582 12.5044 14.9116 12.7334 14.8203 12.946C14.729 13.1585 14.595 13.35 14.4265 13.5086C14.2581 13.6672 14.0589 13.7894 13.8412 13.8678C13.6235 13.9461 13.3921 13.9788 13.1612 13.964C12.9304 13.9491 12.705 13.8869 12.4992 13.7813L10.4475 12.9038L8.40283 17.6766L10.4124 18.5372C10.6182 18.623 10.8049 18.7488 10.9618 18.9072C11.1188 19.0656 11.2427 19.2535 11.3266 19.4602C11.4104 19.6668 11.4525 19.888 11.4503 20.1109C11.4482 20.3339 11.4019 20.5542 11.3141 20.7592C11.2263 20.9642 11.0987 21.1497 10.9388 21.3051C10.7789 21.4604 10.5897 21.5826 10.3823 21.6644C10.1749 21.7463 9.95331 21.7862 9.73037 21.7819C9.50743 21.7776 9.28756 21.7292 9.08345 21.6394Z" fill="black"/>
                </svg>
            </div>
            <div class="btn-text">å¯¼èˆªæ¨¡å¼</div>
        </button>

        <!-- æ¢ç´¢æ¨¡å¼æŒ‰é’® -->
        <button class="floating-explore-btn" id="floating-explore-btn" title="éšæ„èµ°èµ°ï¼Œæ¢ç´¢å‘¨è¾¹">
            <div class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                    <path d="M17.9994 11.8125C19.0007 11.8125 19.9794 11.5156 20.812 10.9593C21.6445 10.403 22.2934 9.61239 22.6765 8.68734C23.0597 7.76229 23.16 6.74439 22.9646 5.76236C22.7693 4.78033 22.2871 3.87828 21.5791 3.17027C20.8711 2.46227 19.9691 1.98011 18.987 1.78478C18.005 1.58944 16.9871 1.68969 16.0621 2.07286C15.137 2.45603 14.3463 3.1049 13.7901 3.93743C13.2338 4.76995 12.9369 5.74873 12.9369 6.75C12.9369 8.09266 13.4703 9.38033 14.4197 10.3297C15.3691 11.2791 16.6567 11.8125 17.9994 11.8125ZM17.9994 5.0625C18.3331 5.0625 18.6594 5.16147 18.9369 5.3469C19.2144 5.53232 19.4307 5.79587 19.5584 6.10422C19.6862 6.41257 19.7196 6.75187 19.6545 7.07922C19.5894 7.40656 19.4286 7.70724 19.1926 7.94324C18.9566 8.17925 18.6559 8.33996 18.3286 8.40508C18.0013 8.47019 17.662 8.43677 17.3536 8.30905C17.0453 8.18133 16.7817 7.96503 16.5963 7.68753C16.4109 7.41002 16.3119 7.08376 16.3119 6.75C16.3119 6.30245 16.4897 5.87323 16.8061 5.55676C17.1226 5.24029 17.5518 5.0625 17.9994 5.0625ZM32.9464 19.4302C32.8324 19.6203 32.6821 19.7862 32.504 19.9183C32.3259 20.0503 32.1235 20.146 31.9084 20.1998C31.6933 20.2536 31.4698 20.2645 31.2504 20.2319C31.0311 20.1992 30.8204 20.1237 30.6303 20.0095C30.5853 19.9828 26.0783 17.3489 19.6869 16.9327V20.7295L28.265 30.375C28.4128 30.5412 28.5263 30.7349 28.5992 30.945C28.6721 31.1551 28.7029 31.3774 28.6898 31.5994C28.6768 31.8214 28.6201 32.0387 28.5231 32.2388C28.4261 32.4389 28.2906 32.6179 28.1244 32.7656C27.9582 32.9134 27.7645 33.0269 27.5544 33.0998C27.3443 33.1727 27.1219 33.2035 26.9 33.1904C26.678 33.1774 26.4607 33.1207 26.2606 33.0237C26.0605 32.9267 25.8815 32.7912 25.7338 32.625L17.9994 23.9189L10.265 32.625C10.1173 32.7912 9.93825 32.9267 9.73815 33.0237C9.53806 33.1207 9.32082 33.1774 9.09882 33.1904C8.87683 33.2035 8.65445 33.1727 8.44436 33.0998C8.23427 33.0269 8.04059 32.9134 7.87439 32.7656C7.70818 32.6179 7.57271 32.4389 7.47569 32.2388C7.37867 32.0387 7.32202 31.8214 7.30896 31.5994C7.2959 31.3774 7.3267 31.1551 7.39958 30.945C7.47247 30.7349 7.58603 30.5412 7.73376 30.375L16.3119 20.7295V16.9327C9.88251 17.3475 5.41626 19.9814 5.36845 20.0109C4.98467 20.2412 4.52513 20.3097 4.09091 20.2011C3.65669 20.0926 3.28336 19.816 3.05306 19.4323C2.82276 19.0485 2.75434 18.5889 2.86286 18.1547C2.97139 17.7205 3.24796 17.3472 3.63173 17.1169C3.87783 16.9678 9.75173 13.5 17.9994 13.5C26.247 13.5 32.121 16.9678 32.367 17.1155C32.7508 17.3456 33.0274 17.7188 33.136 18.1528C33.2447 18.5869 33.1765 19.0464 32.9464 19.4302Z" fill="black"/>
                </svg>
            </div>
            <div class="btn-text">æ¢ç´¢æ¨¡å¼</div>
        </button>
    </div>

    <!-- Difyæ™ºèƒ½é—®ç­”å¡ç‰‡ -->
    <div class="dify-card" id="dify-card">
        <div class="dify-header">
            <div class="dify-title">
                <i class="fas fa-robot"></i>
                AIæ™ºèƒ½é—®ç­”
            </div>
            <div class="dify-controls">
                <button class="dify-minimize-btn" id="dify-minimize-btn" title="æœ€å°åŒ–">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="dify-close-btn" id="dify-close-btn" title="å…³é—­">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="dify-content" id="dify-content">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="dify-input-section" id="dify-input-section">
                <div class="dify-input-group">
                    <label for="dify-location-input">ğŸ  è¯·æè¿°æ‚¨çš„ä½ç½®æˆ–æƒ…å†µï¼š</label>
                    <input type="text" id="dify-location-input" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¤§å­¦å—é—¨" maxlength="200">
                </div>
                <button class="dify-submit-btn" id="dify-submit-btn">
                    <i class="fas fa-paper-plane"></i>
                    è·å–AIå»ºè®®
                </button>
            </div>
            
            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="dify-loading" id="dify-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <div class="loading-text">AIæ­£åœ¨æ€è€ƒä¸­...</div>
            </div>
            
            <!-- é—®é¢˜æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="dify-question-section" id="dify-question-section" style="display: none;">
                <div class="dify-question" id="dify-question"></div>
            </div>
            
            <!-- é€‰æ‹©é¡¹åŒºåŸŸ -->
            <div class="dify-choices-section" id="dify-choices-section" style="display: none;">
                <div class="choices-container" id="choices-container"></div>
            </div>
            
            <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="dify-result-section" id="dify-result-section" style="display: none;">
                <div class="result-content" id="result-content"></div>
                <button class="dify-restart-btn" id="dify-restart-btn">
                    <i class="fas fa-refresh"></i>
                    é‡æ–°å¼€å§‹
                </button>
            </div>
        </div>
    </div>

    <!-- åœ°å›¾æ§åˆ¶æŒ‰é’® -->
    <div class="map-controls">
        <button id="show-route" class="map-control-btn">æ˜¾ç¤ºè·¯çº¿</button>
        <button id="reset-map" class="map-control-btn">é‡ç½®åœ°å›¾</button>
        <button id="show-steps" class="map-control-btn">è¯¦ç»†æ­¥éª¤</button>
        <button id="show-ai-process" class="map-control-btn">AIè¿‡ç¨‹</button>
        <button id="export-route" class="map-control-btn">å¯¼å‡ºè·¯çº¿</button>
        <button id="toggle-dify" class="map-control-btn">AIé—®ç­”</button>
    </div>

    <!-- æ™ºèƒ½è§„åˆ’é¢æ¿ -->
    <div class="planner-panel" id="planner-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">ğŸ§  LLMæ™ºèƒ½è·¯çº¿è§„åˆ’</div>
            </div>
            <button class="close-panel-btn" id="close-panel-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="panel-content">
            <!-- çŠ¶æ€æç¤º -->
            <!-- <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 13px;">
                <i class="fas fa-check-circle"></i>
                <strong>ğŸ¤– AIæ™ºèƒ½è§„åˆ’å‡çº§:</strong> ç”±LLMå®Œå…¨ä¸»å¯¼è·¯å¾„è§„åˆ’å†³ç­–ï¼Œè‡ªä¸»è°ƒç”¨åœ°å›¾APIå¹¶åˆ†æåœ°ç‚¹ä¿¡æ¯
                <br>
                <small style="margin-top: 5px; display: block;">
                    ğŸ§  æ™ºèƒ½æµç¨‹: LLMåˆ†æéœ€æ±‚ â†’ ä¸»åŠ¨æœç´¢åœ°ç‚¹ â†’ ç†è§£åœ°ç‚¹ç‰¹å¾ â†’ æ™ºèƒ½å†³ç­–æœ€ä¼˜è·¯çº¿
                </small>
            </div> -->

            <!-- è§„åˆ’è¡¨å• -->
                <form id="planning-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="start-location">ğŸ èµ·ç‚¹</label>
                            <input type="text" id="start-location" name="start-location" placeholder="è¯·è¾“å…¥èµ·ç‚¹åœ°å€æˆ–åœ°æ ‡" required>
                        </div>
                        <div class="form-group">
                            <label for="city">ğŸ™ï¸ åŸå¸‚</label>
                            <select id="city" name="city" required>
                                <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
                                <option value="åŒ—äº¬">åŒ—äº¬</option>
                                <option value="ä¸Šæµ·">ä¸Šæµ·</option>
                                <option value="å¹¿å·">å¹¿å·</option>
                                <option value="æ·±åœ³">æ·±åœ³</option>
                                <option value="æ­å·">æ­å·</option>
                                <option value="å—äº¬">å—äº¬</option>
                                <option value="é‡åº†">é‡åº†</option>
                                <option value="çº½çº¦">çº½çº¦</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="distance">ğŸ“ æœŸæœ›è·ç¦»</label>
                            <select id="distance" name="distance" required>
                                <option value="">è¯·é€‰æ‹©è·ç¦»</option>
                                <option value="1-3">1-3å…¬é‡Œï¼ˆè½»æ¾æ•£æ­¥ï¼‰</option>
                                <option value="3-5">3-5å…¬é‡Œï¼ˆä¼‘é—²å¾’æ­¥ï¼‰</option>
                                <option value="5-8">5-8å…¬é‡Œï¼ˆå¥èº«èµ°è·¯ï¼‰</option>
                                <option value="8-12">8-12å…¬é‡Œï¼ˆé•¿è·ç¦»å¾’æ­¥ï¼‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="preference">ğŸŒŸ åå¥½ç±»å‹</label>
                            <select id="preference" name="preference" required>
                                <option value="">è¯·é€‰æ‹©åå¥½</option>
                                <option value="æ°´æ™¯">æ°´æ™¯ï¼ˆæ¹–æ³Šã€æ²³æµã€æµ·æ»¨ï¼‰</option>
                                <option value="å…¬å›­">å…¬å›­ï¼ˆåŸå¸‚å…¬å›­ã€ç»¿åœ°ï¼‰</option>
                                <option value="å†å²">å†å²ï¼ˆå¤è¿¹ã€æ–‡åŒ–æ™¯ç‚¹ï¼‰</option>
                                <option value="å•†ä¸š">å•†ä¸šï¼ˆè´­ç‰©è¡—ã€å•†åœˆï¼‰</option>
                                <option value="è‡ªç„¶">è‡ªç„¶ï¼ˆå±±æ—ã€éƒŠé‡ï¼‰</option>
                                <option value="ç§‘æŠ€">ç§‘æŠ€ï¼ˆç§‘æŠ€å›­ã€ç°ä»£å»ºç­‘ï¼‰</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="end-type">ğŸ¯ ç»ˆç‚¹ç±»å‹</label>
                        <select id="end-type" name="end-type" required>
                            <option value="">è¯·é€‰æ‹©ç»ˆç‚¹ç±»å‹</option>
                            <option value="åœ°é“ç«™">åœ°é“ç«™</option>
                            <option value="å…¬äº¤ç«™">å…¬äº¤ç«™</option>
                            <option value="æ™¯ç‚¹">çŸ¥åæ™¯ç‚¹</option>
                            <option value="å•†åœº">è´­ç‰©ä¸­å¿ƒ</option>
                            <option value="èµ·ç‚¹">è¿”å›èµ·ç‚¹ï¼ˆç¯å½¢è·¯çº¿ï¼‰</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="plan-btn" id="plan-button">
                        <i class="fas fa-brain"></i> å¯åŠ¨AIæ™ºèƒ½è§„åˆ’
                    </button>
            </form>
                    
                    <!-- è¶…é…·ç‚«AIè§„åˆ’çŠ¶æ€æ˜¾ç¤º -->
                    <div class="ai-terminal" id="planning-status">
                        <!-- ç»ˆç«¯å¤´éƒ¨ -->
                        <div class="terminal-header">
                            <div class="terminal-buttons">
                                <span class="terminal-btn close"></span>
                                <span class="terminal-btn minimize"></span>
                                <span class="terminal-btn maximize"></span>
                            </div>
                            <div class="terminal-title">
                                <i class="fas fa-robot"></i> AI Smart Planning Terminal v2.0
                                <span class="terminal-status" id="terminal-status">INITIALIZING</span>
                            </div>
                        </div>
                        
                        <!-- ç»ˆç«¯å†…å®¹åŒº -->
                        <div class="terminal-content">
                            <!-- ç³»ç»Ÿä¿¡æ¯ -->
                            <div class="terminal-line system-info">
                                <span class="prompt">[SYSTEM]</span>
                                <span class="loading-text" id="system-info">Booting AI Planning Agent...</span>
                            </div>
                            
                            <!-- ä¸»çŠ¶æ€æ˜¾ç¤º -->
                            <div class="terminal-line main-status">
                                <span class="prompt">[AI-CORE]</span>
                                <span class="typewriter" id="status-text">ğŸ¤– AIæ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...</span>
                            </div>
                            
                            <!-- è¯¦ç»†çŠ¶æ€ -->
                            <div class="terminal-line detail-status" id="status-detail-line" style="display: none;">
                                <span class="prompt">[DEBUG]</span>
                                <span class="detail-text" id="status-detail"></span>
                            </div>
                            
                            <!-- å®æ—¶æ—¥å¿—æ˜¾ç¤ºåŒºåŸŸ -->
                            <div id="console-logs" class="console-logs">
                                <!-- åŠ¨æ€ç”Ÿæˆçš„consoleæ—¥å¿— -->
                            </div>
                            
                            <!-- AIå†³ç­–æ­¥éª¤æ˜¾ç¤º -->
                            <div id="planning-steps" class="planning-steps" style="display: none;">
                                <div class="terminal-line section-header">
                                    <span class="prompt">[AI-STEPS]</span>
                                    <span class="section-title">ğŸ§  Decision Process Breakdown:</span>
                                </div>
                                <div id="steps-list" class="steps-container"></div>
                            </div>
                            
                            <!-- è¿›åº¦æ¡ -->
                            <div class="progress-container" id="progress-container" style="display: none;">
                                <div class="terminal-line">
                                    <span class="prompt">[PROGRESS]</span>
                                    <span class="progress-label" id="progress-label">Processing...</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progress-fill"></div>
                                    <div class="progress-glow"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åº•éƒ¨çŠ¶æ€æ  -->
                        <div class="terminal-footer">
                            <span class="footer-info">
                                <i class="fas fa-microchip"></i> Claude-4 | 
                                <i class="fas fa-map"></i> AMap API | 
                                <span id="timing-info">00:00</span>
                            </span>
                            <span class="footer-status" id="footer-status">READY</span>
                        </div>
            </div>

    <!-- ç»“æœé¢æ¿ -->
    <div class="result-panel" id="result-panel">
        <div class="panel-header">
            <div>
                <div class="panel-title">ğŸ‰ AIæ™ºèƒ½è§„åˆ’ç»“æœ</div>
                <div class="panel-subtitle">ä¸“å±æ•£æ­¥è·¯çº¿è¯¦æƒ…</div>
                </div>
            <button class="close-panel-btn" id="close-result-panel-btn">
                <i class="fas fa-times"></i>
            </button>
            </div>

        <div class="panel-content">
            <!-- è§„åˆ’ç»“æœ -->
            <div id="planned-route">
                <div id="route-summary" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 20px; font-weight: 700; color: #667eea; margin-bottom: 5px;" id="total-distance">--</div>
                        <div style="font-size: 11px; color: #6c757d; text-transform: uppercase;">æ€»è·ç¦»</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 20px; font-weight: 700; color: #667eea; margin-bottom: 5px;" id="total-time">--</div>
                        <div style="font-size: 11px; color: #6c757d; text-transform: uppercase;">é¢„è®¡æ—¶é—´</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 20px; font-weight: 700; color: #667eea; margin-bottom: 5px;" id="waypoints-count">--</div>
                        <div style="font-size: 11px; color: #6c757d; text-transform: uppercase;">é€”ç»æ™¯ç‚¹</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 20px; font-weight: 700; color: #667eea; margin-bottom: 5px;" id="difficulty-level">--</div>
                        <div style="font-size: 11px; color: #6c757d; text-transform: uppercase;">AIè¯„åˆ†</div>
                    </div>
                </div>
                
                <div id="route-details" style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; font-size: 12px;">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„è¯¦ç»†è·¯çº¿ä¿¡æ¯ -->
                    </div>
                
                <div id="route-description">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„è·¯çº¿æè¿°ï¼ŒåŒ…å«AIåˆ†æ -->
                </div>

                <!-- AIè§„åˆ’å†å²æ˜¾ç¤º -->
                <div id="ai-planning-history" style="margin-top: 15px;">
                    <h4 style="color: #2c3e50; margin-bottom: 10px; font-size: 14px;">ğŸ§  AIè§„åˆ’è¿‡ç¨‹å›é¡¾</h4>
                    <div id="planning-history-content" style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-size: 11px;">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„AIè§„åˆ’å†å² -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="walking-planning.js"></script>
    <script>
        // é¢æ¿æ§åˆ¶è„šæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            const floatingBtn = document.getElementById('floating-planner-btn');
            const exploreBtn = document.getElementById('floating-explore-btn');
            const plannerPanel = document.getElementById('planner-panel');
            const resultPanel = document.getElementById('result-panel');
            const closePanelBtn = document.getElementById('close-panel-btn');
            const closeResultPanelBtn = document.getElementById('close-result-panel-btn');

            // æ‰“å¼€è§„åˆ’é¢æ¿
            floatingBtn.addEventListener('click', function() {
                plannerPanel.classList.add('open');
                resultPanel.classList.remove('open');
            });

            // æ¢ç´¢æ¨¡å¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            exploreBtn.addEventListener('click', function() {
                console.log('ğŸ§­ è·³è½¬åˆ°æ¢ç´¢æ¨¡å¼é¡µé¢...');
                window.location.href = 'navigation.html';
            });

            // å…³é—­è§„åˆ’é¢æ¿
            closePanelBtn.addEventListener('click', function() {
                plannerPanel.classList.remove('open');
            });

            // å…³é—­ç»“æœé¢æ¿
            closeResultPanelBtn.addEventListener('click', function() {
                resultPanel.classList.remove('open');
            });

            // ç‚¹å‡»æµ®åŠ¨æŒ‰é’®å¤–éƒ¨å…³é—­é¢æ¿
            document.addEventListener('click', function(e) {
                if (!plannerPanel.contains(e.target) && 
                    !floatingBtn.contains(e.target) && 
                    plannerPanel.classList.contains('open')) {
                    // ä¸è‡ªåŠ¨å…³é—­ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨å…³é—­
                }
            });

            // åˆå§‹åŒ–åœ°å›¾ï¼ˆå æ»¡å…¨å±ï¼‰
            if (typeof initMap === 'function') {
                initMap();
            }
        });

        // é‡å†™displayRouteResultå‡½æ•°çš„å®‰å…¨åŒ…è£…å™¨
        function setupDisplayRouteResultOverride() {
            const maxRetries = 10;
            let retryCount = 0;
            
            function tryOverride() {
                if (typeof window.displayRouteResult === 'function' && !window.originalDisplayRouteResult) {
                    console.log('âœ… æˆåŠŸæ‰¾åˆ°åŸå§‹displayRouteResultå‡½æ•°ï¼Œå¼€å§‹é‡å†™');
                    
                    // ä¿å­˜åŸå§‹å‡½æ•°å¼•ç”¨
                    window.originalDisplayRouteResult = window.displayRouteResult;
                    
                    // é‡å†™å‡½æ•°
                    window.displayRouteResult = function(result) {
                        console.log('ğŸ¯ ä½¿ç”¨é‡å†™çš„displayRouteResultå‡½æ•°ï¼Œæ˜¾ç¤ºåœ¨é¢æ¿ä¸­');
                        
                        try {
                            const resultPanel = document.getElementById('result-panel');
                            const plannerPanel = document.getElementById('planner-panel');
                            
                            // è°ƒç”¨åŸå§‹å‡½æ•°æ›´æ–°ç»“æœæ•°æ®
                            if (window.originalDisplayRouteResult) {
                                window.originalDisplayRouteResult(result);
                            }
                            
                            // æ˜¾ç¤ºç»“æœé¢æ¿ï¼Œéšè—è§„åˆ’é¢æ¿
                            if (resultPanel && plannerPanel) {
                                resultPanel.classList.add('open');
                                plannerPanel.classList.remove('open');
                                console.log('âœ… é¢æ¿æ˜¾ç¤ºçŠ¶æ€å·²æ›´æ–°');
                            }
                        } catch (error) {
                            console.error('âŒ displayRouteResulté‡å†™å‡½æ•°æ‰§è¡Œå‡ºé”™:', error);
                        }
                    };
                } else if (retryCount < maxRetries) {
                    retryCount++;
                    console.log(`â³ ç­‰å¾…displayRouteResultå‡½æ•°åŠ è½½... (${retryCount}/${maxRetries})`);
                    setTimeout(tryOverride, 100);
                } else {
                    console.warn('âš ï¸ æ— æ³•æ‰¾åˆ°åŸå§‹displayRouteResultå‡½æ•°ï¼Œä½¿ç”¨é»˜è®¤è¡Œä¸º');
                }
            }
            
            tryOverride();
        }
        
        // å¯åŠ¨å‡½æ•°é‡å†™
        setupDisplayRouteResultOverride();

        // Dify API åŠŸèƒ½å®ç°
        class DifyAPIClient {
            constructor() {
                this.apiToken = null;
                this.baseUrl = 'https://api.dify.ai/v1';
                this.currentResult = null;
                this.setupEventListeners();
                this.initializeFromEnv();
            }

            initializeFromEnv() {
                // å°è¯•ä»localStorageè·å–token
                this.apiToken = localStorage.getItem('dify_api_token');
                if (!this.apiToken) {
                    // å¦‚æœæ²¡æœ‰tokenï¼Œå¯ä»¥æç¤ºç”¨æˆ·è¾“å…¥æˆ–ä½¿ç”¨é»˜è®¤å€¼
                    console.log('æœªæ‰¾åˆ°Dify API Tokenï¼Œè¯·åœ¨æ§åˆ¶å°è®¾ç½®ï¼šlocalStorage.setItem("dify_api_token", "your-token")');
                    // ä½¿ç”¨æµ‹è¯•Tokenï¼ˆè¯·æ›¿æ¢ä¸ºçœŸå®Tokenï¼‰
                    this.apiToken = 'app-66AeBLjLKMIYEsb5ufu0h8Ch';
                }
            }

            setupEventListeners() {
                // æ§åˆ¶æŒ‰é’®äº‹ä»¶
                document.getElementById('toggle-dify').addEventListener('click', () => {
                    this.toggleDifyCard();
                });

                document.getElementById('dify-close-btn').addEventListener('click', () => {
                    this.hideDifyCard();
                });

                document.getElementById('dify-minimize-btn').addEventListener('click', () => {
                    this.toggleMinimize();
                });

                // æäº¤è¡¨å•äº‹ä»¶
                document.getElementById('dify-submit-btn').addEventListener('click', () => {
                    this.handleSubmit();
                });

                // é‡æ–°å¼€å§‹äº‹ä»¶
                document.getElementById('dify-restart-btn').addEventListener('click', () => {
                    this.restart();
                });

                // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
                document.getElementById('dify-location-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.handleSubmit();
                    }
                });
            }

            toggleDifyCard() {
                const card = document.getElementById('dify-card');
                if (card.classList.contains('show')) {
                    this.hideDifyCard();
                } else {
                    this.showDifyCard();
                }
            }

            showDifyCard() {
                const card = document.getElementById('dify-card');
                card.classList.add('show');
                card.classList.remove('minimized');
            }

            hideDifyCard() {
                const card = document.getElementById('dify-card');
                card.classList.remove('show');
            }

            toggleMinimize() {
                const card = document.getElementById('dify-card');
                card.classList.toggle('minimized');
            }

            async handleSubmit() {
                const locationInput = document.getElementById('dify-location-input');
                const location = locationInput.value.trim();

                if (!location) {
                    this.showMessage('è¯·è¾“å…¥ä½ç½®ä¿¡æ¯', 'error');
                    return;
                }

                if (!this.apiToken) {
                    this.showMessage('è¯·å…ˆè®¾ç½®Dify API Token', 'error');
                    return;
                }

                try {
                    this.showLoading();
                    const result = await this.callDifyAPI(location);
                    this.handleAPIResponse(result);
                } catch (error) {
                    console.error('APIè°ƒç”¨å¤±è´¥:', error);
                    this.showMessage('APIè°ƒç”¨å¤±è´¥: ' + error.message, 'error');
                    this.hideLoading();
                }
            }

            async callDifyAPI(location) {
                const payload = {
                    inputs: {
                        location: location
                    },
                    response_mode: "blocking",
                    user: `web-user-${Date.now()}`
                };

                console.log('ğŸš€ å‘é€Dify APIè¯·æ±‚:', payload);

                const response = await fetch(`${this.baseUrl}/workflows/run`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiToken}`
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`HTTP ${response.status}: ${errorData.message || 'è¯·æ±‚å¤±è´¥'}`);
                }

                const result = await response.json();
                console.log('âœ… Dify APIå“åº”:', result);
                return result;
            }

            handleAPIResponse(result) {
                this.currentResult = result;
                this.hideLoading();

                if (result.data && result.data.outputs && result.data.outputs.task_output) {
                    try {
                        const taskOutput = JSON.parse(result.data.outputs.task_output);
                        this.displayQuestionAndChoices(taskOutput);
                    } catch (e) {
                        console.error('è§£ætask_outputå¤±è´¥:', e);
                        this.showMessage('å“åº”æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                    }
                } else {
                    this.showMessage('APIå“åº”æ ¼å¼ä¸æ­£ç¡®', 'error');
                }
            }

            displayQuestionAndChoices(taskOutput) {
                const { question, choices } = taskOutput;

                // éšè—è¾“å…¥åŒºåŸŸ
                document.getElementById('dify-input-section').style.display = 'none';

                // æ˜¾ç¤ºé—®é¢˜
                if (question) {
                    const questionSection = document.getElementById('dify-question-section');
                    const questionElement = document.getElementById('dify-question');
                    questionElement.textContent = question;
                    questionSection.style.display = 'block';
                }

                // æ˜¾ç¤ºé€‰æ‹©é¡¹
                if (choices && choices.length > 0) {
                    this.renderChoices(choices);
                    document.getElementById('dify-choices-section').style.display = 'block';
                }
            }

            renderChoices(choices) {
                const container = document.getElementById('choices-container');
                container.innerHTML = '';

                choices.forEach((choice, index) => {
                    const choiceElement = document.createElement('div');
                    choiceElement.className = 'choice-item';
                    choiceElement.dataset.index = index;
                    
                    choiceElement.innerHTML = `
                        <div class="choice-option">${choice.option}</div>
                        <div class="choice-action">${choice.next_action || 'ç»§ç»­ä¸‹ä¸€æ­¥'}</div>
                    `;

                    choiceElement.addEventListener('click', () => {
                        this.selectChoice(choiceElement, choice);
                    });

                    container.appendChild(choiceElement);
                });
            }

            selectChoice(choiceElement, choice) {
                // æ¸…é™¤å…¶ä»–é€‰æ‹©é¡¹çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.choice-item').forEach(item => {
                    item.classList.remove('selected');
                });

                // æ ‡è®°å½“å‰é€‰æ‹©é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
                choiceElement.classList.add('selected');

                // æ˜¾ç¤ºç»“æœ
                setTimeout(() => {
                    this.showChoiceResult(choice);
                }, 500);
            }

            showChoiceResult(choice) {
                const resultSection = document.getElementById('dify-result-section');
                const resultContent = document.getElementById('result-content');
                
                resultContent.innerHTML = `
                    <div style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                        <div style="color: #28a745; font-weight: 600; margin-bottom: 8px;">
                            âœ… æ‚¨é€‰æ‹©äº†ï¼š${choice.option}
                        </div>
                        <div style="color: #667eea; font-weight: 500;">
                            â¡ï¸ ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š${choice.next_action}
                        </div>
                    </div>
                `;

                // éšè—é—®é¢˜å’Œé€‰æ‹©åŒºåŸŸ
                document.getElementById('dify-question-section').style.display = 'none';
                document.getElementById('dify-choices-section').style.display = 'none';
                
                // æ˜¾ç¤ºç»“æœåŒºåŸŸ
                resultSection.style.display = 'block';
            }

            restart() {
                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                this.currentResult = null;
                document.getElementById('dify-location-input').value = '';
                
                // æ˜¾ç¤ºè¾“å…¥åŒºåŸŸ
                document.getElementById('dify-input-section').style.display = 'block';
                
                // éšè—å…¶ä»–åŒºåŸŸ
                document.getElementById('dify-question-section').style.display = 'none';
                document.getElementById('dify-choices-section').style.display = 'none';
                document.getElementById('dify-result-section').style.display = 'none';
                document.getElementById('dify-loading').style.display = 'none';
            }

            showLoading() {
                document.getElementById('dify-input-section').style.display = 'none';
                document.getElementById('dify-loading').style.display = 'block';
                document.getElementById('dify-submit-btn').disabled = true;
            }

            hideLoading() {
                document.getElementById('dify-loading').style.display = 'none';
                document.getElementById('dify-submit-btn').disabled = false;
            }

            showMessage(message, type = 'info') {
                // åˆ›å»ºæ¶ˆæ¯æç¤º
                const messageElement = document.createElement('div');
                messageElement.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 9999;
                    animation: slideInRight 0.3s ease-out;
                    max-width: 300px;
                `;

                const colors = {
                    error: '#dc3545',
                    success: '#28a745',
                    info: '#17a2b8',
                    warning: '#ffc107'
                };

                messageElement.style.background = colors[type] || colors.info;
                messageElement.textContent = message;

                document.body.appendChild(messageElement);

                // 3ç§’åè‡ªåŠ¨åˆ é™¤
                setTimeout(() => {
                    if (messageElement.parentNode) {
                        messageElement.parentNode.removeChild(messageElement);
                    }
                }, 3000);
            }
        }

        // åˆå§‹åŒ–Dify APIå®¢æˆ·ç«¯
        const difyClient = new DifyAPIClient();
    </script>

    <!-- å¯¼èˆªæ¨¡å¼å¼¹å‡ºå¡ç‰‡é®ç½© -->
    <div class="navigation-overlay" id="navigation-overlay"></div>

    <!-- å¯¼èˆªæ¨¡å¼å¼¹å‡ºå¡ç‰‡ -->
    <div class="navigation-popup" id="navigation-popup">
        <button class="popup-close-btn" id="popup-close-btn">Ã—</button>
        
        <div class="popup-header">
            <div class="popup-title">
                ğŸ§­ é€‰æ‹©å¯¼èˆªæ–¹å¼
            </div>
            <div class="popup-subtitle">æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„å¯¼èˆªæ¨¡å¼</div>
        </div>

        <div class="feature-cards">
            <div class="feature-card explore-card" onclick="selectNavigationMode('explore')">
                <div class="card-icon">ğŸ—ºï¸</div>
                <div class="card-content">
                    <div class="card-title">æ¢ç´¢æ¨¡å¼</div>
                    <div class="card-description">éšæ„èµ°èµ°ï¼Œå‘ç°å‘¨è¾¹æœ‰è¶£çš„åœ°æ–¹</div>
                </div>
                <div class="card-arrow">â†’</div>
            </div>

            <div class="feature-card planning-card" onclick="selectNavigationMode('planning')">
                <div class="card-icon">ğŸ¯</div>
                <div class="card-content">
                    <div class="card-title">è·¯çº¿è§„åˆ’</div>
                    <div class="card-description">æ™ºèƒ½è§„åˆ’æœ€ä½³æ•£æ­¥è·¯çº¿</div>
                </div>
                <div class="card-arrow">â†’</div>
            </div>
        </div>

        <div class="popup-footer">
            <div class="popup-hint">ç‚¹å‡»é€‰æ‹©ä½ å–œæ¬¢çš„å¯¼èˆªæ–¹å¼</div>
        </div>
    </div>

    <script>
        // å¯¼èˆªæ¨¡å¼å¼¹å‡ºå¡ç‰‡æ§åˆ¶
        function showNavigationPopup() {
            const overlay = document.getElementById('navigation-overlay');
            const popup = document.getElementById('navigation-popup');
            
            overlay.classList.add('show');
            popup.classList.add('show');
            
            // é˜»æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        function hideNavigationPopup() {
            const overlay = document.getElementById('navigation-overlay');
            const popup = document.getElementById('navigation-popup');
            
            overlay.classList.remove('show');
            popup.classList.add('hide');
            
            setTimeout(() => {
                popup.classList.remove('show', 'hide');
                document.body.style.overflow = '';
            }, 300);
        }

        function selectNavigationMode(mode) {
            console.log(`ğŸ§­ é€‰æ‹©äº†${mode === 'explore' ? 'æ¢ç´¢æ¨¡å¼' : 'è·¯çº¿è§„åˆ’'}æ¨¡å¼`);
            
            hideNavigationPopup();
            
            setTimeout(() => {
                if (mode === 'explore') {
                    window.location.href = 'navigation.html';
                } else {
                    const plannerPanel = document.getElementById('planner-panel');
                    plannerPanel.classList.add('open');
                }
            }, 300);
        }

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            // å¯¼èˆªæ¨¡å¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const floatingPlannerBtn = document.getElementById('floating-planner-btn');
            if (floatingPlannerBtn) {
                floatingPlannerBtn.addEventListener('click', showNavigationPopup);
            }

            // å…³é—­æŒ‰é’®äº‹ä»¶
            const closeBtn = document.getElementById('popup-close-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', hideNavigationPopup);
            }

            // é®ç½©ç‚¹å‡»å…³é—­
            const overlay = document.getElementById('navigation-overlay');
            if (overlay) {
                overlay.addEventListener('click', hideNavigationPopup);
            }

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const popup = document.getElementById('navigation-popup');
                    if (popup && popup.classList.contains('show')) {
                        hideNavigationPopup();
                    }
                }
            });
        });
    </script>
</body>
</html>